{
    "$schema": "<relative path to createFormUI.schema.json>",
    "view": {
        "kind": "Form",
        "properties": {
            "title": "AVS Network Design Guide Click-through experience",
            "steps": [
                {
                    "name": "onprem-connectivity",
                    "label": "Connectivity with on-prem sites",
                    "subLabel": {
                        "preValidation": "Provide deployment prefix for the resource groups and resources that will be created.",
                        "postValidation": "Done"
                    },
                    "bladeTitle": "Connectivity with on-prem sites",
                    "elements": [
                        {
                            "name": "onprem-connectivity-section",
                            "type": "Microsoft.Common.Section",
                            "visible": true,
                            "label": "Select an onprem connectivity option",
                            "elements": [
                                {
                                    "name": "onprem-connectivity-option",
                                    "type": "Microsoft.Common.OptionsGroup",
                                    "visible": true,
                                    "label": "Select an onprem connectivity option",
                                    "defaultValue": "ergr",
                                    "toolTip": "",
                                    "constraints": {
                                        "required": true,
                                        "allowedValues": [
                                            {
                                                "label": "ExpressRoute Global Reach",
                                                "value": "ergr"
                                            },
                                            {
                                                "label": "IPSec VPN",
                                                "value": "vpn"
                                            },
                                            {
                                                "label": "Transit over ExpressRoute private peering",
                                                "value": "ertransit"
                                            }
                                        ]
                                    }
                                }
                            ]
                        },
                        {
                            "name": "ipsec-section",
                            "type": "Microsoft.Common.Section",
                            "visible": "[equals(steps('onprem-connectivity').onprem-connectivity-section.onprem-connectivity-option, 'vpn')]",
                            "label": "Select an IPSec VPN option",
                            "elements": [
                                {
                                    "name": "underlay-option",
                                    "type": "Microsoft.Common.OptionsGroup",
                                    "label": "Select the underlay for the IPSec VPN",
                                    "defaultValue": "internet",
                                    "toolTip": "",
                                    "constraints": {
                                        "required": true,
                                        "allowedValues": [
                                            {
                                                "label": "Internet",
                                                "value": "internet"
                                            },
                                            {
                                                "label": "ExpressRoute Microsoft Peering",
                                                "value": "ermp"
                                            },
                                            {
                                                "label": "ExpressRoute Private Peering",
                                                "value": "erpp"
                                            }
                                        ]
                                    }
                                },
                                {
                                    "name": "vnet-option",
                                    "type": "Microsoft.Common.OptionsGroup",
                                    "label": "Select where you want to host the VPN device in Azure",
                                    "defaultValue": "vnet",
                                    "toolTip": "",
                                    "constraints": {
                                        "required": true,
                                        "allowedValues": [
                                            {
                                                "label": "Customer-managed Virtual Network",
                                                "value": "vnet"
                                            },
                                            {
                                                "label": "Virtual WAN Hub",
                                                "value": "vwan"
                                            }
                                        ]
                                    }
                                },
                                {
                                    "name": "device-option",
                                    "type": "Microsoft.Common.OptionsGroup",
                                    "label": "Select the underlay for the IPSec VPN",
                                    "defaultValue": "azurevpngateway",
                                    "toolTip": "",
                                    "constraints": {
                                        "required": true,
                                        "allowedValues": [
                                            {
                                                "label": "Azure VPN Gateway",
                                                "value": "azurevpngateway"
                                            },
                                            {
                                                "label": "Third-party NVA",
                                                "value": "nva"
                                            }
                                        ]
                                    }
                                }
                            ]
                        },
                        {
                            "name": "ertransit-section",
                            "type": "Microsoft.Common.Section",
                            "visible": "[equals(steps('onprem-connectivity').onprem-connectivity-section.onprem-connectivity-option, 'ertransit')]",
                            "label": "Select an ExpressRoute transit option",
                            "elements": [
                                {
                                    "name": "ertransit-option",
                                    "type": "Microsoft.Common.OptionsGroup",
                                    "label": "Select the ER transit architecture",
                                    "defaultValue": "single-vnet",
                                    "toolTip": "",
                                    "constraints": {
                                        "required": true,
                                        "allowedValues": [
                                            {
                                                "label": "Single VNet with supernet advertisment",
                                                "value": "single-vnet"
                                            },
                                            {
                                                "label": "Auxiliary VNet",
                                                "value": "aux-vnet"
                                            }
                                        ]
                                    }
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "vnet-connectivity",
                    "label": "Connectivity with Azure Virtual Networks",
                    "subLabel": {
                        "preValidation": "preValid",
                        "postValidation": "Done"
                    },
                    "bladeTitle": "Connectivity with Azure Virtual Networks",
                    "elements": [
                        {
                            "name": "vnet-connectivity-section",
                            "type": "Microsoft.Common.Section",
                            "visible": true,
                            "label": "VNet connectivity option",
                            "elements": [
                                {
                                    "name": "vnet-connectivity-no-ertransit",
                                    "type": "Microsoft.Common.TextBlock",
                                    "visible": "[not(equals(steps('onprem-connectivity').onprem-connectivity-section.onprem-connectivity-option, 'ertransit'))]",
                                    "options": {
                                        "text": "Connect AVS Private Cloud to this ExpressRoute Virtual Network Gateway:"
                                    }
                                },
                                {
                                    "name": "erGwSelector",
                                    "type": "Microsoft.Solutions.ResourceSelector",
                                    "label": "Select ExpressRoute Virtual Network Gateway",
                                    "resourceType": "Microsoft.Network/virtualNetworkGateways",
                                    "visible": "[not(equals(steps('onprem-connectivity').onprem-connectivity-section.onprem-connectivity-option, 'ertransit'))]",
                                    "options": {
                                      "filter": {
                                      }
                                    }
                                },
                                {
                                    "name": "vnet-connectivity-ertransit",
                                    "type": "Microsoft.Common.OptionsGroup",
                                    "visible": "[equals(steps('onprem-connectivity').onprem-connectivity-section.onprem-connectivity-option, 'ertransit')]",
                                    "type": "Microsoft.Common.TextBlock",
                                    "options": {
                                        "text": "Connectivity to Azure Virtual Networks already provided by the selected onprem connectivity option."
                                    }
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "internet-inbound-connectivity",
                    "label": "Inbound Internet Connectivity",
                    "subLabel": {
                        "preValidation": "perValid",
                        "postValidation": "Done"
                    },
                    "bladeTitle": "Inbound Internet Connectivity",
                    "elements": [
                        {
                            "name": "internet-inbound-connectivity-section",
                            "type": "Microsoft.Common.Section",
                            "visible": true,
                            "label": "Inbound Internet Connectivity",
                            "elements": [
                                {
                                    "name": "internet-inbound-connectivity-option",
                                    "type": "Microsoft.Common.OptionsGroup",
                                    "visible": true,
                                    "label": "Select an onprem connectivity option",
                                    "defaultValue": "azure-pip",
                                    "toolTip": "",
                                    "constraints": {
                                        "required": true,
                                        "allowedValues": [
                                            {
                                                "label": "Expose AVS applications on a Public IP associated to an edge device in an Azure Virtual Network",
                                                "value": "azure-pip"
                                            },
                                            {
                                                "label": "Expose AVS applications on a Public IP associated to an edge device in AVS",
                                                "value": "nsxt-pip"
                                            }
                                        ]
                                    }
                                }
                            ]
                        },
                        {
                            "name": "internet-inbound-connectivity-azure-nva-section",
                            "type": "Microsoft.Common.Section",
                            "visible": "[equals(steps('internet-inbound-connectivity').internet-inbound-connectivity-section.internet-inbound-connectivity-option, 'azure-pip')]",
                            "label": "Deploy NVAs in Azure",
                            "elements": [
                                {
                                    "name": "internet-inbound-connectivity-nva-option",
                                    "type": "Microsoft.Common.OptionsGroup",
                                    "visible": true,
                                    "label": "Select which NVA to deploy in Azure",
                                    "defaultValue": "none",
                                    "toolTip": "",
                                    "constraints": {
                                        "required": true,
                                        "allowedValues": [
                                            {
                                                "label": "Azure Firewall",
                                                "value": "azfw"
                                            },
                                            {
                                                "label": "Azure Application Gateway",
                                                "value": "appgw"
                                            },
                                            {
                                                "label": "I will deploy an NVA later/I will use a third party NVA",
                                                "value": "none"
                                            }
                                        ]
                                    }
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "internet-outbound-connectivity",
                    "label": "Outbound Internet Connectivity",
                    "subLabel": {
                        "preValidation": "perValid",
                        "postValidation": "Done"
                    },
                    "bladeTitle": "Outbound Internet Connectivity",
                    "elements": [
                        {
                            "name": "internet-outbound-connectivity-section",
                            "type": "Microsoft.Common.Section",
                            "visible": true,
                            "label": "Outbound Internet Connectivity",
                            "elements": [
                                {
                                    "name": "internet-outbound-connectivity-nva-option",
                                    "type": "Microsoft.Common.OptionsGroup",
                                    "visible": "[equals(steps('internet-inbound-connectivity').internet-inbound-connectivity-section.internet-inbound-connectivity-option, 'azure-pip')]",
                                    "label": "Choose an internet outbound connectivity option",
                                    "defaultValue": "managed-pip",
                                    "toolTip": "",
                                    "constraints": {
                                        "required": true,
                                        "allowedValues": [
                                            {
                                                "label": "Internet edge device in Azure",
                                                "value": "azure-pip"
                                            }, 
                                            {
                                                "label": "Internet edge device in AVS (Public IP to the NSX-T edge)",
                                                "value": "nsxt-pip"
                                            },
                                            {
                                                "label": "AVS Managed SNAT",
                                                "value": "managed-pip"
                                            }
                                        ]
                                    }
                                },
                                {
                                    "name": "internet-outbound-connectivity-nsxt-pip",
                                    "type": "Microsoft.Common.TextBlock",
                                    "visible": "[equals(steps('internet-inbound-connectivity').internet-inbound-connectivity-section.internet-inbound-connectivity-option, 'nsxt-pip')]",
                                    "options": {
                                        "text": "As you have selected to use use Public IPs on the NSX-T edge for inbound internet connectivity, you must use them for outbound internet connectivity too."
                                    }
                                }
                            ]
                        },
                        {
                            "name": "internet-outbound-connectivity-ars-section",
                            "type": "Microsoft.Common.Section",
                            "visible": "[equals(steps('internet-outbound-connectivity').internet-outbound-connectivity-section.internet-outbound-connectivity-nva-option, 'azure-pip')]",
                            "label": "Default Route Origination",
                            "elements": [
                                {
                                    "name": "internet-outbound-connectivity-ars-option",
                                    "type": "Microsoft.Common.OptionsGroup",
                                    "visible": true,
                                    "label": "Default Route Origination",
                                    "defaultValue": "none",
                                    "toolTip": "",
                                    "constraints": {
                                        "required": true,
                                        "allowedValues": [
                                            {
                                                "label": "Deploy Azure Route Server",
                                                "value": "ars"
                                            }, 
                                            {
                                                "label": "I will deploy Azure Route Server later/I have already deployed Azure Route Server",
                                                "value": "none"
                                            }
                                        ]
                                    }
                                }   
                            ]
                        }
                    ]
                }
            ]
        },
        "outputs": {
            "parameters": {
                "onprem-connectivity-option": "[steps('onprem-connectivity').onprem-connectivity-section.onprem-connectivity-option]",
                "ipsec-option": "[steps('onprem-connectivity').ipsec-section.underlay-option]"           
            },
            "kind": "Subscription"
        }
    }
}